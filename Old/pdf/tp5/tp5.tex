\documentclass{tpcaml}
\tp{5}{Jeux sur les graphes}

% TP CaML LLG 2011 / 2012
% par Nathanaël FIJALKOW
% Utilise les classes LaTeX de Victor Nicollet

\begin{document}
  \maketitle

Ce dernier TP de l'année vous invite à découvrir les jeux sur les graphes, branche de l'informatique développée depuis quelques dizaines d'années, qui a des applications dans plusieurs domaines de l'informatique : vérification, langages formels, logique.
%Ils servent à modéliser les interactions qui peuvent survenir dans ces cadres très différents.
L'objectif de ce TP est d'étudier les propriétés, puis de résoudre de manière automatique certains jeux, 
les jeux d'accessibilité à un joueur et à deux joueurs, puis les jeux de Büchi.

\section{Graphes et arènes}

On considère des graphes \textbf{finis} et \textbf{orientés}. On utilise la notation habituelle suivante :
$n$ est le nombre de sommets et $m$ le nombre d'arêtes.

\vskip2ex
Deux joueurs, Adam et Eve, s'affrontent sur un graphe donné.
Un jeton est initialement placé sur un des sommets (le sommet initial),
puis est déplacé de sommet en sommet, en suivant les arêtes.
L'ensemble des sommets est partitionné en deux sous-ensembles,
$\VE$ et $\VA$: le premier est l'ensemble des sommets appartenant à Eve,
et le second ceux appartenant à Adam.
Lorsque le jeton est sur un sommet appartenant à $\VE$, c'est au tour
d'Eve de jouer, elle déplace le jeton le long d'une arête vers un autre sommet.
De même pour Adam.

\vskip2ex
Une \emph{arène} est la donnée d'un graphe $G = (V,E)$ et d'une partition des sommets
en deux ensembles $\VE$ et $\VA$
(ce qui signifie $\VE \cup \VA = V$ et $\VE \cap \VA = \emptyset$).
On note $\A = ((V,E),(\VE,\VA))$.
Graphiquement, les sommets de $\VE$ sont représentés par des ronds,
et ceux de $\VA$ par des carrés. Voici une arène :
\begin{center}
\begin{picture}(120,30)(0,-5)
	\rpnode[polyangle=45](1)(20,10)(4,5){$0$}
	\node(2)(60,20){$1$}
	\rpnode[polyangle=45](3)(100,10)(4,5){$2$}
  	\node(4)(60,0){$3$}

  	\drawedge(1,2){}
  	\drawedge(2,3){}
  	\drawedge[curvedepth=5](2,4){}
  	\drawedge(3,4){}
	\drawloop[loopangle=0](3){}
  	\drawedge[curvedepth=5](4,2){}
  	\drawedge(4,1){}
\end{picture}
\end{center}

Adam et Eve ont du temps devant eux: ils jouent pendant un temps infini. 
Une partie, souvent notée $\pi$, est un chemin \textbf{infini} : c'est une suite de sommets $\pi = v_0 \cdot v_1 \dots$, 
qui vérifie pour tout $i \in \N$, $(v_i,v_{i+1}) \in E$.
La suite infinie $v_0 v_1 \dots$ est appelée un mot (infini). 
L'ensemble des mots infinis dont les lettres sont des sommets est noté $V^\omega$.

Voici des exemples de parties dans l'arène précédente : $0\cdot 13\cdot 13\cdot 13\cdot 13\dots$,
ou $0123\cdot 0123\cdot 0123\dots$, ou encore $012\cdot 2\cdot 2\cdot 2\dots$.
Il y a évidemment beaucoup d'autres parties, moins ``régulières'' que celles-ci.

On adopte la notation $0\cdot (13)^\omega$ pour $0\cdot 13\cdot 13\cdot 13\ 13\dots$, qui donne sur les autres exemples :
$(0123)^\omega = 0123\cdot 0123\cdot 0123\dots$ et $01\cdot 2^\omega = 012\cdot 2\cdot 2\cdot 2\dots$.

\section{Jeux d'accessibilité}

Dans un jeu d'accessibilité, on se donne en plus de l'arène un sous-ensemble $F \subseteq V$ de sommets,
qui représente les sommets à atteindre pour Eve.
La condition de victoire pour Eve est la suivante : une partie $\pi = v_0 \cdot v_1 \dots$ est gagnée par Eve 
si la partie visite \textit{au moins une fois} $F$, c'est-à-dire s'il existe $i \in \N$ tel que $v_i \in F$. 
Cette condition est notée $\Reach(F)$. 

Les jeux que l'on considère sont à \textbf{somme nulle}, c'est-à-dire que Adam gagne si et seulement si Eve perd,
donc dans un jeu d'accessibilité, l'objectif d'Adam est de ne \textit{jamais} visiter $F$. 

\begin{question}
On considère l'arène ci-dessous, et $F = \set{4}$: ceci définit un jeu d'accessibilité.
Résoudre ce jeu, c'est-à-dire déterminer depuis quelles positions Eve a une stratégie gagnante,
et de même pour Adam.
Donner pour chacun une stratégie gagnante lorsqu'elle existe.
\end{question}

\begin{center}
\begin{picture}(80,30)(0,-5)
	\rpnode[polyangle=45](1)(20,20)(4,5){$0$}
	\node(2)(40,20){$1$}
	\node(3)(20,0){$2$}
	\rpnode[polyangle=45](4)(40,0)(4,5){$3$}
	\rpnode[polyangle=45](5)(60,10)(4,5){$4$}

  	\drawedge(1,3){}
  	\drawedge(1,4){}
  	\drawedge(2,1){}
  	\drawedge[curvedepth=5](2,4){}
  	\drawedge(3,4){}
  	\drawedge[curvedepth=5](3,5){}
  	\drawedge[curvedepth=5](4,2){}
  	\drawedge(4,5){}
  	\drawedge(5,2){}
	\drawloop[loopangle=0](5){}
\end{picture}
\end{center}

Une stratégie pour Eve ou pour Adam, comme on l'imagine,
est une ``recette'' qui dicte quel coup jouer pour chaque situation possible.
Ces stratégies peuvent être extraordinairement compliquées, inclure de la mémoire,
de la randomisation...

Une classe simple de stratégies est donnée par les stratégies positionnelles :
elles définissent, pour chaque sommet appartenant au joueur,
le sommet voisin vers lequel envoyer le jeton,
en ne considérant rien d'autre que le sommet sur lequel est le jeton.
On peut donc les représenter comme des fonctions $\sigma : \VE \to V$
pour Eve et $\tau : \VA \to V$ pour Adam, vérifiant pour tout sommet $v \in \VE$
$(v,\sigma(v)) \in E$ et pour $v \in \VA$, $(v,\tau(v)) \in E$.
\`A partir de maintenant, sauf mention du contraire, une ``stratégie'' désigne une stratégie positionnelle.

Par exemple, dans l'arène précédente, $\sigma(1)$ est soit $2$ soit $3$,
et $\tau(2)$ est soit $2$ soit $3$.

\begin{question}
Pour l'arène précédente, donner des stratégies gagnantes \textit{positionnelles} pour les deux joueurs,
lorsque c'est possible.
\end{question}

\'Etant donné un jeu, on note $\WE$ l'ensemble des sommets depuis lesquels Eve gagne,
et $\WA$ l'ensemble des sommets depuis lesquels Adam gagne.
Notre objectif est d'écrire des algorithmes pour calculer les régions gagnantes des deux joueurs.

\subsection{Résolution des jeux à un joueur}

Les jeux à un joueur sont des cas particuliers des jeux définis plus haut, où $\VA = \emptyset$.
Dans ce cadre, on simplifie les notations : une arène est notée $\A = (V,E)$, puisque $\VE = V$,
une stratégie est une fonction $\sigma : V \to V$.

On note $\Attr_i(F) \subseteq V$ la suite, pour $i \geq 0$, définie par :
$$\begin{array}{cccc}
\Attr_0(F) & = & F \\
\Attr_{i+1}(F) & = & \Attr_i(F) & \cup \quad \{u \in V \mid \exists (u,v) \in E, v \in \Attr_i(F) \}
\end{array}$$

\begin{question}
Montrer que $(\Attr_i(F))_{i \geq 0}$ est une suite croissante pour l'inclusion.
En déduire qu'elle est stationnaire, à partir de quel rang ?
Montrer que sa limite $\Attr(F)$ est $\WE$.
\end{question}

On note pour $v \in V$, le rang est $\rg(v) = \min \set{i \mid v \in \Attr_i(F)}$,
le minimum d'un ensemble vide étant par convention $\infty$.

\begin{question}
Déduire de la question précédente une construction d'une stratégie gagnante depuis $\WE$
(indication : on fera décroître le rang).
\end{question}

On s'intéresse maintenant à la réalisation d'un algorithme calculant $\WE$.
Pour représenter le graphe on peut utiliser la matrice d'adjacence $M$, de taille $n \times n$, qui vérifie :
$$M_{u,v} = \left \{
\begin{array}{cc}
1 & \mbox{si } (u,v) \in E \\
0 & \mbox{sinon}
\end{array} \right.$$

\begin{question}
\'Ecrire une fonction \code{resoudre\_accessibilite\_unjoueur\_matrice}
qui étant donné la matrice d'adjence $M$, retourne $\WE$.
Tout choix vous est laissé pour la représentation de $\WE$.
\end{question}

\begin{question}
Quelle est la complexité de \code{resoudre\_accessibilite\_unjoueur\_matrice} ?
\end{question}

Pour représenter le graphe on peut aussi utiliser des listes d'adjacence :
$\Succ_u$ est la liste des successeurs (immédiats) de $u$,
$\Pred_u$ est la liste des prédecesseurs (immédiats) de $u$.
On conserve ces listes dans un tableau de taille $n$.

\begin{question}
\'Ecrire une fonction \code{resoudre\_accessibilite\_unjoueur\_liste}
qui étant donné le tableau $\Pred$ des listes de prédecesseurs, retourne $\WE$.
\end{question}

\begin{question}
Quelle est la complexité de \code{resoudre\_accessibilite\_unjoueur\_liste} ?
\end{question}

\subsection{Résolution des jeux à deux joueurs}

La situation est plus compliquée à deux joueurs!

On note $\Attr_i(F) \subseteq V$ la suite, pour $i \geq 0$, définie par :
$$\begin{array}{cccc}
\Attr_0(F) & = & F \\
\Attr_{i+1}(F) & = & \Attr_i(F) \\
 & \cup & \{u \in \VE \mid \exists (u,v) \in E, v \in \Attr_i(F) \} \\
 & \cup & \{u \in \VA \mid \qquad \ldots \qquad \} \\
\end{array}$$

\begin{question}
Compléter la définition ci-dessus.
Montrer que $(\Attr_i(F))_{i \geq 0}$ est une suite croissante pour l'inclusion.
En déduire qu'elle est stationnaire, à partir de quel rang ?
\end{question}

\begin{question}
De même que dans le cas à un joueur, définir un fonction de rang.
Montrer que sa limite $\Attr(F)$ est incluse dans $\WE$.
\end{question}

\begin{question}
Montrer que $V \setminus \Attr(F)$ est inclus dans $\WA$.
Conclure.
\end{question}

Pour représenter le jeu, on utilise trois tableaux de taille $n$ :
$\Pred$ donne les listes de prédecesseurs, et $\Joueur$ et $\Final$ sont des tableaux de booléens,
indiquant si le sommet appartient à Eve et s'il est dans $F$.
 
\begin{question}
\'Ecrire une fonction \code{resoudre\_accessibilite\_deuxjoueurs}
qui étant donné le tableau $\Pred$ des listes de prédecesseurs,
le tableau $\Joueur$ et le tableau $\Final$, retourne $\WE$.
\end{question}

\begin{question}
Quelle est la complexité de \code{resoudre\_accessibilite\_deuxjoueurs} ?
\end{question}

\subsection{Quelques propriétés}

Considérons $\WE$ et $\WA$, les positions gagnantes pour Eve et pour Adam 
dans le jeu d'accessibilité associé à $F$.

\begin{question}
Montrer que $\WE$ et $\WA$ forment une partition de $V$,
c'est-à-dire que $\WE \cap \WA = \emptyset$ et $V = \WE \cup \WA$.
Laquelle de ces deux propositions n'était pas évidente ?
\end{question}

\begin{question}
Montrer que si $v \in \WE$, alors Eve a une stratégie gagnante \textit{positionnelle} depuis $v$,
et de même pour Adam : si $v \in \WA$, alors il a une stratégie gagnante \textit{positionnelle} depuis $v$.
\end{question}

\begin{question}
Montrer comment modéliser le jeu de la tablette de chocolat par un jeu d'accessibilité.
En déduire qu'un des deux joueurs a toujours une stratégie gagnante.
Montrer que c'est toujours celui qui commence.
\end{question}


\section{Jeux d'accessibilité répétée et de B\"uchi}

On s'intéresse maintenant à des conditions de victoire plus compliquées que l'accessibilité.

\begin{itemize}
 \item \textbf{Accessibilité répétée d'ordre $k$} : étant donné un entier $k \geq 1$,
une partie $\pi = v_0 \cdot v_1 \dots$ est gagnée par Eve elle visite \textit{au moins $k$ fois} $F$, 
c'est-à-dire s'il existe $i_1 < i_2 < \dots < i_k$ tel que $v_{i_j} \in F$ pour tout $1 \leq j \leq k$. 
Cette condition est notée $\Reach(F,k)$. 
 \item \textbf{Büchi} : une partie $\pi = v_0 \cdot v_1 \dots$ est gagnée par Eve 
si elle visite $F$ un nombre \textit{infini} de fois, c'est-à-dire s'il existe $i_1 < i_2 < \dots$ 
tel que $v_{i_j} \in F$ pour tout $j \geq 1$. Cette condition est notée $\Buchi(F)$. 
\end{itemize}


\begin{question}
Avec l'arène de la question 1 et $F = \set{2,4}$, on définit maintenant
un jeu d'accessibilité répétée d'ordre $k \geq 1$.
Résoudre ce jeu, et donner pour chacun une
stratégie gagnante \textit{positionnelle} depuis $\WE$ et $\WA$.
\end{question}

\begin{question}
Toujours avec la même arène et $F = \set{4}$, on définit maintenant
un jeu de B\"uchi.
Résoudre ce jeu, et donner pour chacun une
stratégie gagnante depuis $\WE$ et $\WA$.
\end{question}

\begin{question}
Revenons dans le cas général (arène quelconque).
Montrer :
$$\WE(\Reach(F)) = \WE(\Reach(F,1)) \supseteq \WE(\Reach(F,2)) \supseteq \ldots \supseteq \WE(\Buchi(F))$$
Montrer que les inclusions peuvent être strictes, en exhibant des arènes comme contre-exemples.
\end{question}

\subsection{Résolution des jeux d'accessibilité répétée}

\begin{question}
Décrire un algorithme récursif calculant $\WE$ pour un jeu d'accessibilité répétée d'ordre $k$. Démontrer qu'il est correct.
\end{question}

\begin{question}
\'Ecrire une fonction \code{resoudre\_accessibilite\_repetee\_deuxjoueurs}
qui étant donné le tableau $\Pred$ des listes de prédecesseurs,
le tableau $\Joueur$ et le tableau $\Final$, retourne $\WE$.
\end{question}

\subsection{Résolution des jeux de B\"uchi}

\begin{question}
Décrire un algorithme récursif calculant $\WE$ pour un jeu de Büchi. 
Démontrer qu'il est correct 
(indication : utiliser la résolution des jeux d'accessibilité répétée pour un ordre suffisamment grand).
\end{question}

\begin{question}
\'Ecrire une fonction \code{resoudre\_buchi\_deuxjoueurs}
qui étant donné le tableau $\Pred$ des listes de prédecesseurs,
le tableau $\Joueur$ et le tableau $\Final$, retourne $\WE$.
\end{question}

\begin{question}
Quelle est la complexité de \code{resoudre\_buchi\_deuxjoueurs} ?
\end{question}

\section{Questions difficiles}

\begin{question}
Donner un jeu (arène et condition de victoire) où 
Eve gagne en utilisant une stratégie ``générale'', mais perd si elle utilise une stratégie positionnelle.
\end{question}

\begin{question}
Il existe des jeux ``non-déterminés'', c'est-à-dire où aucun des deux joueurs n'a de stratégie gagnante.
En voici un exemple. 
Considérons la fonction $X : \set{0,1}^{\omega} \rightarrow \set{0,1}$, qui a une suite infinie de $0$ et de $1$ 
associe $0$ ou $1$, définie par :
$X(0^{\omega}) = 0$ et $X(u \cdot 0 \cdot v) \neq X(u \cdot 1 \cdot v)$.
Le jeu est le suivant : chacun à leur tour (en commençant par Eve), Eve et Adam choisissent un mot fini sur $\set{0,1}$.
Notons $u_1,v_1,u_2,v_2,\ldots$ les mots choisis.
Eve gagne si $X(u_1 \cdot v_1 \cdot u_2 \cdot v_2 \ldots) = 1$, Adam gagne sinon.
Montrer qu'aucun des deux joueurs n'a de stratégie gagnante.
\end{question}

Bonnes vacances !
\end{document}
